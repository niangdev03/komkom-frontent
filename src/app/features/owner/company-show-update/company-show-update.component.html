<div class="w-full h-full flex flex-col">
  <div class="px-4 sm:px-6 pt-4 sm:pt-6 pb-6 sm:pb-10 bg-primary-600/10 flex-none">
    <div class="flex flex-col sm:flex-row items-center container px-0">
      <button @scaleIn class="sm:hidden text-primary-600 mb-4 sm:mb-0 focus:outline-none" mat-icon-button type="button">
        <mat-icon svgIcon="mat:menu"></mat-icon>
      </button>
      <h2 class="display-1 font-bold m-0 flex items-center w-full max-w-4xs mr-0 sm:mr-6 mb-4">
        <span @scaleIn
          class="w-10 h-10 sm:w-12 sm:h-12 rounded-full text-primary-600 ltr:mr-3 sm:ltr:mr-4 rtl:ml-3 sm:rtl:ml-4 bg-primary-600/10 flex items-center justify-center">
          <mat-icon svgIcon="mat:info"></mat-icon>
        </span>
        <span @fadeInRight class="block">Informations sur l'entreprise</span>
      </h2>
    </div>
  </div>

  <div class="m-4 flex flex-col md:flex-row md:items-start" *ngIf="company">

    <!-- === Vue infos === -->
    <div *ngIf="!isUpdateMode" class="flex-auto card">
      <div class="flex items-start justify-between border-b">
        <div class="px-6 py-4">
          <h2 class="title m-0">Informations de l'entreprise</h2>
        </div>
        <button class="m-2 flex-none" color="primary" mat-mini-fab matTooltip="Modifier" type="button"
          (click)="toggleEdit()">
          <mat-icon svgIcon="mat:edit"></mat-icon>
        </button>
      </div>

      <div class="px-6 py-4 grid grid-cols-1 sm:grid-cols-2 gap-4">
        <!-- Logo - Version centrée et agrandie -->
        <div class="py-6 flex flex-col items-center col-span-full text-center">
          <div @fadeInRight class="flex flex-col items-center">
            <div class="w-32 h-32 flex items-center justify-center bg-primary-50 rounded-2xl mb-4">
              <img *ngIf="company.logo_url" [src]="company.logo_url" [alt]="company.name"
                class="w-28 h-28 object-contain">
              <mat-icon *ngIf="!company.logo_url" class="text-primary-600 text-4xl" svgIcon="mat:business"></mat-icon>
            </div>
            <p class="m-0 caption text-hint">Logo de l'entreprise</p>
          </div>
        </div>

        <div class="py-3 flex items-center">
          <div @scaleIn
            class="w-10 h-10 rounded-full bg-primary-600/10 text-primary-600 ltr:mr-3 rtl:ml-3 flex items-center justify-center">
            <mat-icon class="icon-sm" svgIcon="mat:business"></mat-icon>
          </div>
          <div @fadeInRight>
            <p class="m-0 body-1">{{ company.name }}</p>
            <p class="m-0 caption text-hint">Nom de l'entreprise</p>
          </div>
        </div>

        <div class="py-3 flex items-center" *ngIf="company.short_name">
          <div @scaleIn
            class="w-10 h-10 rounded-full bg-primary-600/10 text-primary-600 ltr:mr-3 rtl:ml-3 flex items-center justify-center">
            <mat-icon class="icon-sm" svgIcon="mat:short_text"></mat-icon>
          </div>
          <div @fadeInRight>
            <p class="m-0 body-1">{{ company.short_name }}</p>
            <p class="m-0 caption text-hint">Nom court</p>
          </div>
        </div>

        <div class="py-3 flex items-center" *ngIf="company.slogan">
          <div @scaleIn
            class="w-10 h-10 rounded-full bg-primary-600/10 text-primary-600 ltr:mr-3 rtl:ml-3 flex items-center justify-center">
            <mat-icon class="icon-sm" svgIcon="mat:format_quote"></mat-icon>
          </div>
          <div @fadeInRight>
            <p class="m-0 body-1">{{ company.slogan }}</p>
            <p class="m-0 caption text-hint">Slogan</p>
          </div>
        </div>

        <div class="py-3 flex items-center">
          <div @scaleIn
            class="w-10 h-10 rounded-full bg-primary-600/10 text-primary-600 ltr:mr-3 rtl:ml-3 flex items-center justify-center">
            <mat-icon class="icon-sm" svgIcon="mat:email"></mat-icon>
          </div>
          <div @fadeInRight>
            <p class="m-0 body-1">{{ company.email }}</p>
            <p class="m-0 caption text-hint">Adresse email</p>
          </div>
        </div>

        <div class="py-3 flex items-center">
          <div @scaleIn
            class="w-10 h-10 rounded-full bg-primary-600/10 text-primary-600 ltr:mr-3 rtl:ml-3 flex items-center justify-center">
            <mat-icon class="icon-sm" svgIcon="mat:phone"></mat-icon>
          </div>
          <div @fadeInRight>
            <p class="m-0 body-1">{{ company.phone_one }} <span *ngIf="company.phone_two">/ {{ company.phone_two
                }}</span></p>
            <p class="m-0 caption text-hint">Téléphones</p>
          </div>
        </div>

        <div class="py-3 flex items-center">
          <div @scaleIn
            class="w-10 h-10 rounded-full bg-primary-600/10 text-primary-600 ltr:mr-3 rtl:ml-3 flex items-center justify-center">
            <mat-icon class="icon-sm" svgIcon="mat:place"></mat-icon>
          </div>
          <div @fadeInRight>
            <p class="m-0 body-1">{{ company.head_office_address }}</p>
            <p class="m-0 caption text-hint">Adresse du siège</p>
          </div>
        </div>
      </div>
    </div>

    <!-- === Formulaire édition === -->
    <div *ngIf="isUpdateMode" class="card flex-auto">
      <div class="flex items-start justify-between border-b">
        <div class="px-6 py-4">
          <h2 class="title m-0">Modifier l'entreprise</h2>
        </div>
        <button class="m-2 flex-none" color="warn" mat-mini-fab matTooltip="Annuler" type="button"
          (click)="toggleEdit()">
          <mat-icon svgIcon="mat:close"></mat-icon>
        </button>
      </div>

      <form [formGroup]="companyForm" (ngSubmit)="onSubmit()" class="px-6 py-4 grid grid-cols-1 sm:grid-cols-2 gap-4">

        <!-- Champ logo -->
        <div class="col-span-full">
          <label class="block text-sm font-medium mb-2 text-gray-700">Logo de l'entreprise</label>
          <vex-upload-file [defaultImageUrl]="company.logo_url" [defaultImageName]="'Photo de profil'"
            (fileUploaded)="onFileUpload($event)" (fileRemoved)="onFileRemove()"></vex-upload-file>
          <div class="text-xs text-gray-500 mt-1">Taille recommandée: 200x200px. Formats: JPG, PNG, SVG</div>
        </div>

        <!-- Nom de l'entreprise -->
        <div class="flex flex-col">
          <label class="block text-sm font-medium mb-2 text-gray-700">Nom de l'entreprise</label>
          <div class="relative">
            <input type="text" formControlName="name"
              class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent"
              placeholder="Entrez le nom de l'entreprise">
            <mat-icon class="absolute right-3 top-2 text-gray-400" svgIcon="mat:business"></mat-icon>
          </div>
          <div *ngIf="companyForm.controls['name'].invalid && companyForm.controls['name'].touched" class="mt-1">
            <div *ngIf="companyForm.controls['name'].errors?.['required']" class="text-red-600 text-xs">
              Le nom est obligatoire
            </div>
            <div *ngIf="companyForm.controls['name'].errors?.['minlength']" class="text-red-600 text-xs">
              Minimum 4 caractères
            </div>
            <div *ngIf="companyForm.controls['name'].errors?.['maxlength']" class="text-red-600 text-xs">
              Maximum 255 caractères
            </div>
          </div>
        </div>

        <!-- Nom court -->
        <div class="flex flex-col">
          <label class="block text-sm font-medium mb-2 text-gray-700">Nom court</label>
          <div class="relative">
            <input type="text" formControlName="short_name"
              class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent"
              placeholder="Entrez le nom court">
            <mat-icon class="absolute right-3 top-2 text-gray-400" svgIcon="mat:short_text"></mat-icon>
          </div>
          <div *ngIf="companyForm.controls['short_name'].invalid && companyForm.controls['short_name'].touched"
            class="mt-1">
            <div *ngIf="companyForm.controls['short_name'].errors?.['minlength']" class="text-red-600 text-xs">
              Minimum 2 caractères
            </div>
            <div *ngIf="companyForm.controls['short_name'].errors?.['maxlength']" class="text-red-600 text-xs">
              Maximum 50 caractères
            </div>
          </div>
        </div>

        <!-- Slogan -->
        <div class="flex flex-col">
          <label class="block text-sm font-medium mb-2 text-gray-700">Slogan</label>
          <div class="relative">
            <input type="text" formControlName="slogan"
              class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent"
              placeholder="Entrez le slogan">
            <mat-icon class="absolute right-3 top-2 text-gray-400" svgIcon="mat:format_quote"></mat-icon>
          </div>
          <div *ngIf="companyForm.controls['slogan'].invalid && companyForm.controls['slogan'].touched" class="mt-1">
            <div *ngIf="companyForm.controls['slogan'].errors?.['minlength']" class="text-red-600 text-xs">
              Minimum 2 caractères
            </div>
            <div *ngIf="companyForm.controls['slogan'].errors?.['maxlength']" class="text-red-600 text-xs">
              Maximum 255 caractères
            </div>
          </div>
        </div>

        <!-- Adresse du siège -->
        <div class="flex flex-col">
          <label class="block text-sm font-medium mb-2 text-gray-700">Adresse du siège</label>
          <div class="relative">
            <input type="text" formControlName="head_office_address"
              class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent"
              placeholder="Entrez l'adresse du siège">
            <mat-icon class="absolute right-3 top-2 text-gray-400" svgIcon="mat:place"></mat-icon>
          </div>
          <div
            *ngIf="companyForm.controls['head_office_address'].invalid && companyForm.controls['head_office_address'].touched"
            class="mt-1">
            <div *ngIf="companyForm.controls['head_office_address'].errors?.['maxlength']" class="text-red-600 text-xs">
              Maximum 255 caractères
            </div>
          </div>
        </div>

        <!-- Email -->
        <div class="flex flex-col">
          <label class="block text-sm font-medium mb-2 text-gray-700">Email</label>
          <div class="relative">
            <input type="email" formControlName="email_company"
              class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent"
              placeholder="Entrez l'email">
            <mat-icon class="absolute right-3 top-2 text-gray-400" svgIcon="mat:email"></mat-icon>
          </div>
          <div *ngIf="companyForm.controls['email_company'].invalid && companyForm.controls['email_company'].touched"
            class="mt-1">
            <div *ngIf="companyForm.controls['email_company'].errors?.['required']" class="text-red-600 text-xs">
              L'email est obligatoire
            </div>
            <div *ngIf="companyForm.controls['email_company'].errors?.['email']" class="text-red-600 text-xs">
              Format email invalide
            </div>
            <div *ngIf="companyForm.controls['email_company'].errors?.['minlength']" class="text-red-600 text-xs">
              Minimum 8 caractères
            </div>
            <div *ngIf="companyForm.controls['email_company'].errors?.['maxlength']" class="text-red-600 text-xs">
              Maximum 50 caractères
            </div>
            <div *ngIf="companyForm.controls['email_company'].errors?.['pattern']" class="text-red-600 text-xs">
              Format email incorrect
            </div>
          </div>
        </div>

        <!-- Téléphone principal -->
        <div class="flex flex-col">
          <label class="block text-sm font-medium mb-2 text-gray-700">Téléphone principal</label>
          <div class="relative">
            <input type="tel" formControlName="phone_one"
              class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent"
              placeholder="Entrez le téléphone principal">
            <mat-icon class="absolute right-3 top-2 text-gray-400" svgIcon="mat:phone"></mat-icon>
          </div>
          <div *ngIf="companyForm.controls['phone_one'].invalid && companyForm.controls['phone_one'].touched"
            class="mt-1">
            <div *ngIf="companyForm.controls['phone_one'].errors?.['required']" class="text-red-600 text-xs">
              Le téléphone principal est obligatoire
            </div>
            <div *ngIf="companyForm.controls['phone_one'].errors?.['minlength']" class="text-red-600 text-xs">
              Minimum 9 caractères
            </div>
            <div *ngIf="companyForm.controls['phone_one'].errors?.['maxlength']" class="text-red-600 text-xs">
              Maximum 20 caractères
            </div>
          </div>
        </div>

        <!-- Deuxième téléphone -->
        <div class="flex flex-col">
          <label class="block text-sm font-medium mb-2 text-gray-700">Deuxième téléphone</label>
          <div class="relative">
            <input type="tel" formControlName="phone_two"
              class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent"
              placeholder="Entrez le deuxième téléphone">
            <mat-icon class="absolute right-3 top-2 text-gray-400" svgIcon="mat:phone"></mat-icon>
          </div>
          <div *ngIf="companyForm.controls['phone_two'].invalid && companyForm.controls['phone_two'].touched"
            class="mt-1">
            <div *ngIf="companyForm.controls['phone_two'].errors?.['maxlength']" class="text-red-600 text-xs">
              Maximum 20 caractères
            </div>
          </div>
        </div>

        <div class="col-span-full flex justify-end mt-4">
          <button mat-raised-button color="primary" type="submit" [disabled]="isSubmitting || companyForm.invalid">
            <mat-icon svgIcon="mat:save" class="ltr:mr-2 rtl:ml-2"></mat-icon>
            {{ isSubmitting ? 'Enregistrement...' : 'Enregistrer' }}
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
