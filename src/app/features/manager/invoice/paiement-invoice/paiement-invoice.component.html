<h2 mat-dialog-title class="text-center font-bold text-xl">Régler la facture</h2>
<mat-dialog-content class="mat-typography">
  <div class="invoice-summary bg-blue-50 p-4 rounded-md mb-4">
    <div class="flex justify-between mb-2">
      <span class="text-gray-600">Numéro de facture:</span>
      <span class="font-bold">{{ data.invoice.invoice_number }}</span>
    </div>
    <div class="flex justify-between mb-2">
      <span class="text-gray-600">Client:</span>
      <span class="font-medium">{{ data.invoice.customer_name }}</span>
    </div>
    <div class="flex justify-between mb-2">
      <span class="text-gray-600">Montant total:</span>
      <span class="font-medium">{{ data.invoice.amount_total | integerSeparator }} FCFA</span>
    </div>
    <div class="flex justify-between mb-2">
      <span class="text-gray-600">Montant payé:</span>
      <span class="font-medium">{{ data.invoice.amount_paid | integerSeparator }} FCFA</span>
    </div>
    <div class="flex justify-between">
      <span class="text-gray-600">Solde restant:</span>
      <span class="font-bold text-red-600">{{ data.invoice.balance | integerSeparator }} FCFA</span>
    </div>
  </div>

  <form [formGroup]="paymentForm">
    <div class="grid grid-cols-1 gap-4">
      <mat-form-field appearance="outline" class="w-full">
        <mat-label>Date de paiement</mat-label>
        <input matInput [matDatepicker]="picker" formControlName="date">
        <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
        <mat-datepicker #picker></mat-datepicker>
        <mat-error *ngIf="paymentForm.get('date')?.hasError('required')">
          La date est requise
        </mat-error>
      </mat-form-field>

      <mat-form-field appearance="outline" class="w-full">
        <mat-label>Montant</mat-label>
        <input matInput type="number" formControlName="amount">
        <span matSuffix class="mr-2">FCFA</span>
        <mat-error *ngIf="paymentForm.get('amount')?.hasError('required')">
          Le montant est requis
        </mat-error>
        <mat-error *ngIf="paymentForm.get('amount')?.hasError('max')">
          Le montant ne peut pas dépasser le solde restant
        </mat-error>
        <mat-error *ngIf="paymentForm.get('amount')?.hasError('min')">
          Le montant doit être supérieur à 0
        </mat-error>
      </mat-form-field>

      <mat-form-field appearance="outline" class="w-full">
        <mat-label>Mode de paiement</mat-label>
        <mat-select formControlName="payment_type">
          <mat-option value="cash">Espèces</mat-option>
          <mat-option value="wave">Wave</mat-option>
          <mat-option value="OM">Orange Money</mat-option>
        </mat-select>
        <mat-error *ngIf="paymentForm.get('payment_type')?.hasError('required')">
          Le mode de paiement est requis
        </mat-error>
      </mat-form-field>
    </div>
  </form>
</mat-dialog-content>

<mat-dialog-actions align="end">
  <button [disabled]="isSubmitting" mat-button mat-dialog-close color="warn">Annuler</button>
  <button 
    mat-raised-button 
    color="primary" 
    [disabled]="paymentForm.invalid || isSubmitting"
    (click)="submitPayment()">
    <mat-icon *ngIf="isSubmitting" class="m-2">
      <mat-spinner diameter="18"></mat-spinner>
    </mat-icon>
    <span>Confirmer le paiement</span>
  </button>
</mat-dialog-actions>

